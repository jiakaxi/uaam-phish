# 训练配置对比分析

## 📊 上次成功训练 vs 当前训练

### ✅ **上次成功的配置**（准确率 99.01%）

来自 `experiments/url_only/checkpoints/url-only-best.ckpt`：

```yaml
模型配置:
  dropout: 0.1          # 较小的dropout

训练配置:
  epochs: 50            # 50轮训练
  batch_size: 64        # 较大的batch size
  lr: 0.0001            # 学习率 1e-4
  patience: 5
```

**训练结果**：
- 测试集准确率: 99.01% (100/101)
- 模型收敛良好

---

### ❌ **当前训练配置**（准确率 53.47%）

来自 `experiments/url_baseline_20251023_071805/config.yaml`：

```yaml
模型配置:
  dropout: 0.2          # 更大的dropout (2倍)

训练配置:
  epochs: 10            # 仅10轮训练 (减少5倍)
  batch_size: 32        # 较小的batch size (减少一半)
  lr: 2e-05             # 学习率 0.00002 (减少5倍!)

硬件配置:
  accelerator: cpu      # 使用CPU
```

**训练结果**：
- 验证集准确率: 53.47%
- 模型未收敛，始终预测类别1

---

## 🔴 **关键问题分析**

### 1. **学习率过低** (最严重)

```
上次成功: 0.0001 (1e-4)
当前配置: 0.00002 (2e-5)
差异: 减少了 5倍！
```

**影响**：
- 学习率太低导致模型学习速度极慢
- 10轮训练完全不够模型收敛
- 参数更新幅度太小，模型几乎"学不动"

### 2. **训练轮数太少**

```
上次成功: 50 epochs
当前配置: 10 epochs
差异: 减少了 5倍！
```

**影响**：
- 50轮才能充分训练
- 10轮远远不够，模型刚开始学习就停止了

### 3. **Batch Size 减半**

```
上次成功: 64
当前配置: 32
差异: 减少一半
```

**影响**：
- 更小的batch size导致梯度估计更不稳定
- 与较低的学习率结合，导致训练更慢

### 4. **Dropout 增大**

```
上次成功: 0.1
当前配置: 0.2
差异: 增大1倍
```

**影响**：
- 更大的dropout可能导致欠拟合
- 在小数据集上过度正则化

---

## 💡 **为什么模型只预测类别1？**

在**学习率过低 + 训练轮数过少**的组合下：

1. **第0-5轮**：模型随机初始化，损失缓慢下降
2. **第6-10轮**：模型发现"预测类别1"能获得53%准确率
3. **训练结束**：模型还没来得及学习真正的特征就停止了

这就像一个学生：
- 学习速度很慢（学习率低）
- 只学习了10天（轮数少）
- 发现"瞎猜B"能得53分，就不继续学了

---

## ✅ **立即修复方案**

### 方案1: 恢复上次成功的配置（推荐）

修改配置文件，使用成功的参数：

```yaml
model:
  dropout: 0.1

train:
  epochs: 50
  bs: 64
  lr: 0.0001  # 1e-4
```

### 方案2: 折中配置（如果资源有限）

```yaml
model:
  dropout: 0.1

train:
  epochs: 30      # 至少30轮
  bs: 64
  lr: 0.0001      # 保持1e-4
```

---

## 🚀 **立即执行**

### 选项A: 修改configs/data/url_only.yaml

在train部分添加/修改：

```yaml
train:
  epochs: 50
  bs: 64
  lr: 0.0001
  log_every: 50
  weight_decay: 1e-5

model:
  dropout: 0.1
```

### 选项B: 使用命令行覆盖

```bash
python scripts/train_hydra.py \
  data=url_only \
  train.epochs=50 \
  train.bs=64 \
  train.lr=0.0001 \
  model.dropout=0.1
```

---

## 📈 **预期效果**

使用正确配置后，预期：
- ✅ 准确率应回到 95%+
- ✅ AUROC > 0.95
- ✅ 模型能区分两个类别
- ✅ 训练在20-30轮后收敛

---

## 🔍 **为什么配置被改了？**

可能原因：
1. 使用了不同的配置文件（url_only.yaml vs default.yaml）
2. 配置文件被覆盖或修改
3. 使用了不同的训练脚本或命令

**建议**：
- 查看 `configs/data/url_only.yaml`
- 确认使用正确的配置文件
- 或直接使用命令行参数覆盖

---

*报告生成时间: 2025-10-23*
